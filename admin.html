<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração - Chopp do Claudinho</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-10">
        <h1 class="text-3xl font-bold text-center text-[#ee1d23] mb-8">Painel de Administração</h1>
        <p class="text-center text-gray-600 mb-8">Altere os textos e preços do site. Clique em "Salvar Alterações" para atualizar o site em tempo real.</p>
        
        <form id="admin-form" class="space-y-8">
            <!-- Seção Textos do Site -->
            <section>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Textos do Site</h2>
                <div class="space-y-4">
                    <div>
                        <label for="header-title" class="block text-sm font-medium text-gray-700">Título do Cabeçalho</label>
                        <input type="text" id="header-title" name="header-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="header-subtitle" class="block text-sm font-medium text-gray-700">Subtítulo do Cabeçalho</label>
                        <input type="text" id="header-subtitle" name="header-subtitle" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="chopp-section-title" class="block text-sm font-medium text-gray-700">Título da Seção de Chopps</label>
                        <input type="text" id="chopp-section-title" name="chopp-section-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="supplies-section-title" class="block text-sm font-medium text-gray-700">Título da Seção de Suprimentos</label>
                        <input type="text" id="supplies-section-title" name="supplies-section-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="rental-section-title" class="block text-sm font-medium text-gray-700">Título da Seção de Locação</label>
                        <input type="text" id="rental-section-title" name="rental-section-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="calculator-section-title" class="block text-sm font-medium text-gray-700">Título da Calculadora</label>
                        <input type="text" id="calculator-section-title" name="calculator-section-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="footer-text" class="block text-sm font-medium text-gray-700">Texto do Rodapé</label>
                        <input type="text" id="footer-text" name="footer-text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="footer-contact-title" class="block text-sm font-medium text-gray-700">Título do Contato do Rodapé</label>
                        <input type="text" id="footer-contact-title" name="footer-contact-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="footer-phone" class="block text-sm font-medium text-gray-700">Telefone do Rodapé</label>
                        <input type="text" id="footer-phone" name="footer-phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="footer-email" class="block text-sm font-medium text-gray-700">E-mail do Rodapé</label>
                        <input type="email" id="footer-email" name="footer-email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="footer-address" class="block text-sm font-medium text-gray-700">Endereço do Rodapé</label>
                        <input type="text" id="footer-address" name="footer-address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500">
                    </div>
                </div>
            </section>
            <section>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Preços dos Produtos</h2>
                <div id="product-prices-container" class="space-y-6">
                </div>
            </section>
            <button type="submit" class="w-full bg-[#ee1d23] text-white font-bold py-3 px-6 rounded-full mt-6 transition-colors duration-300 hover:bg-red-700 shadow-lg">Salvar Alterações</button>
            <p id="status-message" class="text-center mt-4 text-sm font-medium hidden"></p>
        </form>
    </div>

    <!-- Scripts do Firebase -->
    <script type="module">
        // Importa as funções necessárias do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // As variáveis globais __app_id, __firebase_config e __initial_auth_token
        // são fornecidas pelo ambiente do Canvas.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        let app;
        let db;
        let auth;
        let userId;

        // Função de inicialização do Firebase e autenticação
        const initializeFirebase = async () => {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    
                    await signInAnonymously(auth);
                    userId = auth.currentUser.uid;
                    
                    console.log("Firebase e autenticação inicializados com sucesso!");
                    loadData();
                } else {
                    console.error("Configuração do Firebase não encontrada. Verifique as variáveis do ambiente.");
                }
            } catch (error) {
                console.error("Erro ao inicializar o Firebase ou autenticar:", error);
            }
        };

        // Carrega os dados do Firestore e preenche os campos do formulário
        const loadData = async () => {
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/config/content`);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    console.log("Dados carregados com sucesso:", data);
                    
                    document.getElementById('header-title').value = data.headerTitle || '';
                    document.getElementById('header-subtitle').value = data.headerSubtitle || '';
                    document.getElementById('chopp-section-title').value = data.choppSectionTitle || '';
                    document.getElementById('supplies-section-title').value = data.suppliesSectionTitle || '';
                    document.getElementById('rental-section-title').value = data.rentalSectionTitle || '';
                    document.getElementById('calculator-section-title').value = data.calculatorSectionTitle || '';
                    document.getElementById('footer-text').value = data.footerText || '';
                    document.getElementById('footer-contact-title').value = data.footerContactTitle || '';
                    document.getElementById('footer-phone').value = data.footerPhone || '';
                    document.getElementById('footer-email').value = data.footerEmail || '';
                    document.getElementById('footer-address').value = data.footerAddress || '';
                    
                } else {
                    console.log("Nenhum dado encontrado. O formulário está vazio.");
                }
            } catch (e) {
                console.error("Erro ao ler os dados do Firestore:", e);
            }
        };

        // Função para salvar os dados do formulário no Firestore
        const saveData = async (event) => {
            event.preventDefault();
            const statusMessage = document.getElementById('status-message');
            statusMessage.classList.add('hidden');

            try {
                const data = {
                    headerTitle: document.getElementById('header-title').value,
                    headerSubtitle: document.getElementById('header-subtitle').value,
                    choppSectionTitle: document.getElementById('chopp-section-title').value,
                    suppliesSectionTitle: document.getElementById('supplies-section-title').value,
                    rentalSectionTitle: document.getElementById('rental-section-title').value,
                    calculatorSectionTitle: document.getElementById('calculator-section-title').value,
                    footerText: document.getElementById('footer-text').value,
                    footerContactTitle: document.getElementById('footer-contact-title').value,
                    footerPhone: document.getElementById('footer-phone').value,
                    footerEmail: document.getElementById('footer-email').value,
                    footerAddress: document.getElementById('footer-address').value,
                };

                const docRef = doc(db, `artifacts/${appId}/users/${userId}/config/content`);
                await setDoc(docRef, data, { merge: true });

                statusMessage.textContent = 'Alterações salvas com sucesso!';
                statusMessage.classList.remove('hidden');
                statusMessage.classList.add('text-green-600');
                console.log("Documento gravado com ID: ", docRef.id);
            } catch (e) {
                statusMessage.textContent = 'Erro ao salvar: ' + e.message;
                statusMessage.classList.remove('hidden');
                statusMessage.classList.add('text-red-600');
                console.error("Erro ao adicionar documento: ", e);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            document.getElementById('admin-form').addEventListener('submit', saveData);
        });
    </script>
</body>
</html>
